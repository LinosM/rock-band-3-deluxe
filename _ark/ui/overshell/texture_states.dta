(dxState_TextureMenu
   (view
      {do
         ($options
            {array 0})
         {push_back $options os_fretboard}
         {push_back $options os_spotlight}         
         {push_back $options os_emissive}         
         {push_back $options os_gems}         
         {push_back $options os_animation}         
         {push_back $options os_smashers}         
         {push_back $options os_flames}         
         {push_back $options os_sus}         
         {push_back $options os_score}         
         {push_back $options os_crowdmeter}         
         {push_back $options os_rails}         
         {push_back $options os_odbar}         
         {push_back $options os_multiring}         
         {push_back $options os_keyboard}         
         {push_back $options os_voxhw}         
         {push_back $options os_voxarrow}         
         {dx_state_setup dxState_TextureMenu FALSE}
         {set $state_hold dxState_TextureMenu}
      }
      {overshell_view_chooser}
   )
   (SELECT_MSG
      {switch {$component selected_sym}
         (os_fretboard
            {set $dx_tracked_texture_loader highway}
            {$this show_state dxState_DTATextureLoader})
         (os_spotlight
            {set $dx_tracked_texture_loader spotlight}
            {$this show_state dxState_DTATextureLoader})
         (os_emissive
            {set $dx_tracked_texture_loader emissives}
            {$this show_state dxState_DTATextureLoader})
         (os_gems
            {set $dx_tracked_texture_loader gems}
            {$this show_state dxState_DTATextureLoader})
         (os_smashers
            {set $dx_tracked_texture_loader smasher}
            {$this show_state dxState_DTATextureLoader})
         (os_flames
            {set $dx_tracked_texture_loader flames}
            {$this show_state dxState_DTATextureLoader})
         (os_sus 
            {$this show_state dxState_SustainSel})
         (os_score
            {set $dx_tracked_texture_loader score}
            {$this show_state dxState_DTATextureLoader})
         (os_rails
            {set $dx_tracked_texture_loader rails}
            {$this show_state dxState_DTATextureLoader})
         (os_odbar
            {set $dx_tracked_texture_loader overdrive_bar}
            {$this show_state dxState_DTATextureLoader})
         (os_multiring
            {set $dx_tracked_texture_loader multiplier_ring}
            {$this show_state dxState_DTATextureLoader})
         (os_crowdmeter
            {set $dx_tracked_texture_loader crowd_meter}
            {$this show_state dxState_DTATextureLoader})
         (os_keyboard
            {set $dx_tracked_texture_loader keyboard_lanes}
            {$this show_state dxState_DTATextureLoader})
         (os_voxhw
            {set $dx_tracked_texture_loader vocal_highway}
            {$this show_state dxState_DTATextureLoader})
         (os_voxarrow
            {set $dx_tracked_texture_loader vocal_arrow}
            {$this show_state dxState_DTATextureLoader})
         (os_animation
            {set $dx_tracked_texture_loader animated_gems}
            {if_else $animatedgems
               {$this show_state dxState_DTATextureLoader}
               {$this show_state dxState_AnimatedGemWarn}
            }
         )
      }
   )
   (exit 
      {dx_state_pos_tracker}
      {set $dx_track_to_reset_choose_character_texture TRUE}
   )
   (on_cancel
      {$this show_state dxState_ThemeMenu}
    )
)

(dxState_DTATextureLoader
   (view
      {do
         ($options
            {array 0})
         ($options
            {switch $dx_tracked_texture_loader
               (emissives (#include ../track/emissives/emissives.dta))
               (score (#include ../track/score/score.dta))
               (smasher (#include ../track/smashers/smashers.dta))
               (flames (#include ../track/flames/flames.dta))
               (rails (#include ../track/rails/rails.dta))
               (overdrive_bar (#include ../track/overdrive_bar/overdrive_bar.dta))
               (highway (#include ../track/highways/highways.dta))
               (spotlight (#include ../track/spotlights/spotlights.dta))
               (multiplier_ring (#include ../track/multiplier_ring/multiplier_ring.dta))
               (crowd_meter (#include ../track/crowd_meter/crowd_meter.dta))
               (gems (#include ../track/gems/gems.dta))
               (keyboard_lanes (#include ../track/keyboards/keyboards.dta))
               (vocal_highway (#include ../track/voxhw/voxhw.dta))
               (vocal_arrow (#include ../track/voxarrow/voxarrow.dta))
               (animated_gems ("rb4"))
            }
         )
         {switch $dx_tracked_texture_loader
            (emissives {dx_state_setup dxState_DTAEmissiveLoader FALSE})
            (score {dx_state_setup dxState_DTAScoreLoader FALSE})
            (smasher {dx_state_setup dxState_DTASmasherLoader FALSE})
            (flames {dx_state_setup dxState_DTAFlamesLoader FALSE})
            (rails {dx_state_setup dxState_DTARailsLoader FALSE})
            (overdrive_bar {dx_state_setup dxState_DTAOverdriveBarLoader FALSE})
            (highway {dx_state_setup dxState_DTAHighwayLoader FALSE})
            (spotlight {dx_state_setup dxState_DTASpotlightLoader FALSE})
            (multiplier_ring {dx_state_setup dxState_DTAMultiplierRingLoader FALSE})
            (crowd_meter {dx_state_setup dxState_DTACrowdMeterLoader FALSE})
            (gems {dx_state_setup dxState_DTAGemsLoader FALSE})
            (keyboard_lanes {dx_state_setup dxState_DTAKeyboardLanesLoader FALSE})
            (vocal_highway {dx_state_setup dxState_DTAVocalHighwayLoader FALSE})
            (vocal_arrow {dx_state_setup dxState_DTAVocalArrowLoader FALSE})
            (animated_gems {dx_state_setup dxState_DTAAnimatedGemsLoader FALSE})
         }
         {if $state_hold ;we need to ignore this state when leaving to the instrument checker
            {set $previous_state $state_hold}
            {set $state_hold FALSE}
        }
      }
      {overshell_view_chooser}
   )
   (enter
      {do
         {online_options.grp add_object choose_character.mesh}
         {choose_character.mesh set_local_pos_index 2 175}
         {choose_character.mesh set_local_scale_index 0 0.2}
         {choose_character.mesh set_local_scale_index 2 0.4}
         {choose_character.mat set diffuse_tex choose_character.tex}
      }
      {switch $dx_tracked_texture_loader
         (emissives
            {choose_character.tex set_bitmap {sprint "ui/track/emissives/" $emissivegtr ".png"}}
            {choose_character.tex iterate_refs $ref {$ref set color {pack_color $emissive_r $emissive_g $emissive_b}}}
            {choose_character.tex iterate_refs $ref {$ref set intensify TRUE}}
         )
         (score
            {choose_character.tex set_bitmap {sprint "ui/track/score/scoreboard_frame_" $scoretex ".png"}}
         )
         (smasher
            {choose_character.tex set_bitmap {sprint "ui/track/smashers/gem_smashers_guitar_" $smasher ".png"}}
         )
         (flames
            {choose_character.tex set_bitmap {sprint "ui/track/flames/flare_style_" $flames ".png"}}
         )
         (rails
            {choose_character.tex set_bitmap {sprint "ui/track/rails/rails_" $rails ".png"}}
         )
         (overdrive_bar
            {choose_character.tex set_bitmap {sprint "ui/track/overdrive_bar/overdrive_meter_background_fill_" $odbar ".png"}}
         )
         (highway
            {choose_character.tex set_bitmap {sprint "ui/track/highways/" $highwaygtr ".png"}}
         )
         (spotlight
            {choose_character.tex set_bitmap {sprint "ui/track/spotlights/" $spotlightgtr ".png"}}
         )
         (multiplier_ring
            {choose_character.tex set_bitmap {sprint "ui/track/multiplier_ring/streak_meter_bg_" $multiring ".png"}}
         )
         (crowd_meter
            {choose_character.tex set_bitmap {sprint "ui/track/crowd_meter/crowd_meter_frame_" $crowdmeter ".png"}}
         )
         (gems
            {choose_character.tex set_bitmap {sprint "ui/track/gems/prism_gems_" $gem ".png"}}
         )
         (keyboard_lanes
            {choose_character.tex set_bitmap {sprint "ui/track/keyboards/track_lanes_keyboard_" $keyboard ".png"}}
         )
         (vocal_highway
            {choose_character.tex set_bitmap {sprint "ui/track/voxhw/vocal_bg_combined_" $voxhw ".png"}}
         )
         (vocal_arrow
            {choose_character.tex set_bitmap {sprint "ui/track/voxarrow/arrow_lead_c_" $voxarrow ".png"}}
         )
         (animated_gems
            {choose_character.tex set_bitmap {sprint "ui/track/animated_gems/prism_gems_rb4/prism_gems_rb4_0.png"}}
         )
      }
   )
   (SCROLL_MSG
      {set $dx_list_scroll_texture {$component selected_sym}}
      {switch $dx_tracked_texture_loader
         (emissives
            {choose_character.tex set_bitmap {sprint "ui/track/emissives/" $dx_list_scroll_texture ".png"}}
         )
         (score
            {choose_character.tex set_bitmap {sprint "ui/track/score/scoreboard_frame_" $dx_list_scroll_texture ".png"}}
         )
         (smasher
            {choose_character.tex set_bitmap {sprint "ui/track/smashers/gem_smashers_guitar_" $dx_list_scroll_texture ".png"}}
         )
         (flames
            {choose_character.tex set_bitmap {sprint "ui/track/flames/flare_style_" $dx_list_scroll_texture ".png"}}
         )
         (rails
            {choose_character.tex set_bitmap {sprint "ui/track/rails/rails_" $dx_list_scroll_texture ".png"}}
         )
         (overdrive_bar
            {choose_character.tex set_bitmap {sprint "ui/track/overdrive_bar/overdrive_meter_background_fill_" $dx_list_scroll_texture ".png"}}
         )
         (highway
            {choose_character.tex set_bitmap {sprint "ui/track/highways/" $dx_list_scroll_texture ".png"}}
         )
         (spotlight
            {choose_character.tex set_bitmap {sprint "ui/track/spotlights/" $dx_list_scroll_texture ".png"}}
         )
         (multiplier_ring
            {choose_character.tex set_bitmap {sprint "ui/track/multiplier_ring/streak_meter_bg_" $dx_list_scroll_texture ".png"}}
         )
         (crowd_meter
            {choose_character.tex set_bitmap {sprint "ui/track/crowd_meter/crowd_meter_frame_" $dx_list_scroll_texture ".png"}}
         )
         (gems
            {choose_character.tex set_bitmap {sprint "ui/track/gems/prism_gems_" $dx_list_scroll_texture ".png"}}
         )
         (keyboard_lanes
            {choose_character.tex set_bitmap {sprint "ui/track/keyboards/track_lanes_keyboard_" $dx_list_scroll_texture ".png"}}
         )
         (vocal_highway
            {choose_character.tex set_bitmap {sprint "ui/track/voxhw/vocal_bg_combined_" $dx_list_scroll_texture ".png"}}
         )
         (vocal_arrow
            {choose_character.tex set_bitmap {sprint "ui/track/voxarrow/arrow_lead_c_" $dx_list_scroll_texture ".png"}}
         )
         (animated_gems
            {choose_character.tex set_bitmap {sprint "ui/track/animated_gems/prism_gems_" $dx_list_scroll_texture "/prism_gems_" $dx_list_scroll_texture "_0.png"}}
         )
      }
      ;{$this update}
   )
   (SELECT_MSG
      {switch $dx_tracked_texture_loader
         (emissives
            {set $dx_tracked_emissive {$component selected_sym}}
            {$this show_state dxState_InstrumentTextureChooser}
         )
         (score
            {set $scorecustomtexture TRUE}
            {set $scoretex {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (smasher
            {set $smashercustomtexture TRUE}
            {set $smasher {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (flames
            {set $flamescustomtexture TRUE}
            {set $flames {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (rails
            {set $railscustomtexture TRUE}
            {set $rails {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (overdrive_bar
            {set $odbarcustomtexture TRUE}
            {set $odbar {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (highway
            {set $dx_tracked_highway {$component selected_sym}}
            {$this show_state dxState_InstrumentTextureChooser}
         )
         (spotlight
            {set $dx_tracked_spotlight {$component selected_sym}}
            {$this show_state dxState_InstrumentTextureChooser}
         )
         (multiplier_ring
            {set $multiringcustomtexture TRUE}
            {set $multiring {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (crowd_meter
            {set $crowdmetercustomtexture TRUE}
            {set $crowdmeter {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (gems
            {set $animatedgems FALSE}
            {set $animatedgemscustomtexture FALSE}
            {set $animatedgemname none}
            {set $gemcustomtexture TRUE}
            {set $gem {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (keyboard_lanes
            {set $keyboardcustomtexture TRUE}
            {set $keyboard {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (vocal_highway
            {set $voxhwcustomtexture TRUE}
            {set $voxhw {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (vocal_arrow
            {set $voxarrowcustomtexture TRUE}
            {set $voxarrow {$component selected_sym}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
         (animated_gems
            {set $gemcustomtexture TRUE}
            {set $gem {$component selected_sym}}
            {set $animatedgems TRUE}
            {set $animatedgemscustomtexture TRUE}
            {set $animatedgemname {$component selected_sym}}
            {choose_character.tex set_bitmap {sprint "ui/track/animated_gems/prism_gems_" $animatedgemname "/prism_gems_" $animatedgemname "_0.png"}}
            {dx_revert_choose_char_mesh}
            {$this show_state $previous_state}
         )
      }
   )
   (exit 
      {dx_state_pos_tracker}
   )
   (on_cancel
      {$this show_state $previous_state}
      {dx_revert_choose_char_mesh}
   )
)

(dxState_InstrumentTextureChooser
   (view
      {do
         ($options
            {array 0})
         {push_back $options all_instruments}
         {push_back $options guitar}
         {push_back $options bass}
         {push_back $options drums}
         {push_back $options keys}
         ;{push_back $options pro_guitar}
         ;{push_back $options pro_bass}
         {set $state_hold $previous_state}
         {dx_state_setup dxState_InstrumentTextureChooser FALSE}
      }
      {overshell_view_chooser}
   )
   (SELECT_MSG
      {switch {$component selected_sym}
         (all
            {switch $dx_tracked_texture_loader
                (emissives
                    {set $dx_emissiveupdate TRUE}
                    {set $emissivegtrcustomtexture TRUE} {set $emissivegtr $dx_tracked_emissive}
                    {set $emissivebasscustomtexture TRUE} {set $emissivebass $dx_tracked_emissive}
                    {set $emissivedrumcustomtexture TRUE} {set $emissivedrum $dx_tracked_emissive}
                    {set $emissivekeyscustomtexture TRUE} {set $emissivekeys $dx_tracked_emissive}
                )
                (highway
                    {set $highwaygtrcustomtexture TRUE} {set $highwaygtr $dx_tracked_highway}
                    {set $highwaybasscustomtexture TRUE} {set $highwaybass $dx_tracked_highway}
                    {set $highwaydrumcustomtexture TRUE} {set $highwaydrum $dx_tracked_highway}
                    {set $highwaykeyscustomtexture TRUE} {set $highwaykeys $dx_tracked_highway}
                )
                (spotlight
                    {set $spotlightgtrcustomtexture TRUE} {set $spotlightgtr $dx_tracked_spotlight}
                    {set $spotlightbasscustomtexture TRUE} {set $spotlightbass $dx_tracked_spotlight}
                    {set $spotlightdrumcustomtexture TRUE} {set $spotlightdrum $dx_tracked_spotlight}
                    {set $spotlightkeyscustomtexture TRUE} {set $spotlightkeys $dx_tracked_spotlight}
                )
            }
         )
         (guitar
            {switch $dx_tracked_texture_loader
                (emissives {set $dx_emissiveupdate TRUE} {set $emissivegtrcustomtexture TRUE} {set $emissivegtr $dx_tracked_emissive})
                (highway {set $highwaygtrcustomtexture TRUE} {set $highwaygtr $dx_tracked_highway})
                (spotlight {set $spotlightgtrcustomtexture TRUE} {set $spotlightgtr $dx_tracked_spotlight})
            }
         )
         (bass
            {switch $dx_tracked_texture_loader
                (emissives {set $dx_emissiveupdate TRUE} {set $emissivebasscustomtexture TRUE} {set $emissivebass $dx_tracked_emissive})
                (highway {set $highwaybasscustomtexture TRUE} {set $highwaybass $dx_tracked_highway})
                (spotlight {set $spotlightbasscustomtexture TRUE} {set $spotlightbass $dx_tracked_spotlight})
            }
         )
         (drums
            {switch $dx_tracked_texture_loader
                (emissives {set $dx_emissiveupdate TRUE} {set $emissivedrumcustomtexture TRUE} {set $emissivedrum $dx_tracked_emissive})
                (highway {set $highwaydrumcustomtexture TRUE} {set $highwaydrum $dx_tracked_highway})
                (spotlight {set $spotlightdrumcustomtexture TRUE} {set $spotlightdrum $dx_tracked_spotlight})
            }
         )
         (keys
            {switch $dx_tracked_texture_loader
                (emissives {set $dx_emissiveupdate TRUE} {set $emissivekeyscustomtexture TRUE} {set $emissivekeys $dx_tracked_emissive})
                (highway {set $highwaykeyscustomtexture TRUE} {set $highwaykeys $dx_tracked_highway})
                (spotlight {set $spotlightkeyscustomtexture TRUE} {set $spotlightkeys $dx_tracked_spotlight})
            }
         )
      }
      {$this show_state dxState_TextureMenu}
   )
   (exit 
      {dx_state_pos_tracker}
      {dx_revert_choose_char_mesh}
   )
   (on_cancel
      {$this show_state dxState_TextureMenu}
   )
)

(dxState_SustainSel
   (view options)
   (enter
      {options.lst set_selected 0}
      {options.lst set_data (os_nosus os_rb2sus os_rb3sus os_rb4sus)}
   )
   (SELECT_MSG
      {switch {$component selected_sym}
         (os_rb3sus
            {set $dx_sustaincustomtexture TRUE}
            {set $dx_sustain rb3})
         (os_rb2sus
            {set $dx_sustaincustomtexture TRUE}
            {set $dx_sustain rb2})
         (os_rb4sus
            {set $dx_sustaincustomtexture TRUE}
            {set $dx_sustain rb4})
         (os_nosus
            {set $dx_sustaincustomtexture FALSE}
            {set $dx_sustain empty}
         )
      }
      {options.lst set_data (os_nosus os_rb2sus os_rb3sus os_rb4sus)}
   )
   (on_cancel
      {$this show_state dxState_TextureMenu}
   )
)
  

(dxState_AnimatedGemWarn
   (view confirm_action)
   (enter
      {confirm_action.lst set_selected 1}
      {handle
         ($this set_confirm_actions os_animmsg (overshell_continue overshell_cancel))})
   (SELECT_MSG
      {switch {$component selected_sym}
      (overshell_continue
         {$this show_state dxState_DTATextureLoader})
      (overshell_cancel
         {$this show_state dxState_TextureMenu})})
      (on_cancel
         {$this show_state dxState_TextureMenu}))